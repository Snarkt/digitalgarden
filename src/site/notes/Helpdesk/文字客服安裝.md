---
{"dg-publish":true,"permalink":"/helpdesk//"}
---


此篇使用 Helpdesk4J-2.1.1   
   
顯示今天修改過的檔案   
find /SRM/Helpdesk4J/ -type f -mtime 0   
   
用sed一次取代   
停止防火牆、關閉SELINUX   
`sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/sysconfig/selinux`   
`sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config`   
   
`systemctl disable firewalld.service`   
   
重新啟動，ssh會需要重連   
`reboot`   
   
創建 /SRM/Helpdesk4J 資料夾   
`mkdir -p /SRM/Helpdesk4J`   
![image_m.png](/img/user/img/image_m.png)
`sudo yum install unzip`   
   
`unzip tomcat9.zip`   
`unzip AppData.zip -d AppData`   
   
解壓縮 jdk1.8   
`tar -zxvf openlogic-openjdk-8u282-b08-linux-x64.tar.gz`   
`mv openlogic-openjdk-8u282-b08-linux-x64 openjdk`   
   
`cp Webhook.war Helpdesk4J.war /SRM/Helpdesk4J/tomcat9/webapps/`   
   
`unzip Helpdesk4J.war -d Helpdesk4J`   
`unzip Webhook.war -d Webhook.war`   
   
解壓縮錯的話，指定檔案以外全部刪除   
`rm -rf !(Helpdesk4J.war\|Webhook.war)`   
   
安裝 RabbitMQ   
RabbitMQ由erlang語言開發，需要安裝erlang環境   
下面網址為RabbitMQ對應erlang版本支持表   
[https://www.rabbitmq.com/docs/which-erlang](https://www.rabbitmq.com/docs/which-erlang)    
此篇安裝RabbitMQ 3.13.7 erlang 26.2   
   
rpm安裝erlang   
   
查看所有版本   
[https://packagecloud.io/rabbitmq/erlang](https://packagecloud.io/rabbitmq/erlang)    
centos stream 10 沒有支援，所以重新安裝了centos stream 9   
版本中el7 el8 el9說明   
el7 是Red Hat 7.x、CentOS 7.x的縮寫   
el8 是Red Hat 8.x、CentOS 8.x的縮寫   
el9 是Red Hat 9.x、CentOS 9.x的縮寫   
   
查詢26.2 el/9   
安裝 erlang-26.2.5.4-1.el9.x86\_64.rpm   
[https://packagecloud.io/rabbitmq/erlang/packages/el/9/erlang-26.2.5.4-1.el9.x86\_64.rpm?distro\_version\_id=240](https://packagecloud.io/rabbitmq/erlang/packages/el/9/erlang-26.2.5.4-1.el9.x86_64.rpm?distro_version_id=240)    
   
```
curl -s https://packagecloud.io/install/repositories/rabbitmq/erlang/script.rpm.sh | sudo bash

```
   
```
sudo yum install erlang-26.2.5.4-1.el9.x86_64

```
   
rpm安裝rabbitmq   
   
查看所有版本   
[https://packagecloud.io/rabbitmq/rabbitmq-server](https://packagecloud.io/rabbitmq/rabbitmq-server)   
   
對照版本表，選擇3.13.7 el/9   
[https://www.rabbitmq.com/docs/which-erlang](https://www.rabbitmq.com/docs/which-erlang)   
   
跟el/8同個rpm   
rabbitmq-server-3.13.7-1.el8.noarch.rpm   
[https://packagecloud.io/rabbitmq/rabbitmq-server/packages/el/9/rabbitmq-server-3.13.7-1.el8.noarch.rpm?distro\_version\_id=240](https://packagecloud.io/rabbitmq/rabbitmq-server/packages/el/9/rabbitmq-server-3.13.7-1.el8.noarch.rpm?distro_version_id=240)    
   
```
curl -s https://packagecloud.io/install/repositories/rabbitmq/rabbitmq-server/script.rpm.sh | sudo bash

```
   
```
sudo yum install rabbitmq-server-3.13.7-1.el8.noarch

```
   
啟動 rabbitmq，沒有啟動文客會無法開啟   
`sudo systemctl start rabbitmq-server`   
   
安裝MariaDB   
`yum install mariadb-server.x86\_64`   
`systemctl start mariadb`   
`systemctl enable mariadb`   
```
#密碼 password
mysql -u root -p

#建立資料庫
create database Helpdesk4J default character set utf8mb4 default collate utf8mb4_general_ci;
show databases;

#刪除資料庫
drop database wise_robot

```
無法透過hibernate創建結構時可能需要用DB工具重新建立   
   
設定DB遠端連線   
MariaDB為了提高安全性，默認只監聽127.0.0.1的3306 port 並禁止TCP連線   
`select user,host from mysql.user;`   
查看Host為localhost   
![image_z 1.png](/img/user/img/image_z%201.png)
[為 MariaDB 配置遠端存取權限](https://blog.csdn.net/lanuage/article/details/78846766)   
%代表所有IP，password表示將用這個密碼登入root用戶   
`\*.\*` anytype會隱藏掉，記得別漏掉   
`GRANT ALL PRIVILEGES ON \*.\* TO 'root'@'%' IDENTIFIED BY 'password' WITH GRANT OPTION;`   
   
指定IP連線   
VM   
`GRANT ALL PRIVILEGES ON \*.\* TO 'root'@'192.168.182.136' IDENTIFIED BY 'password' WITH GRANT OPTION;`   
主機   
`GRANT ALL PRIVILEGES ON \*.\* TO 'root'@'192.168.182.1' IDENTIFIED BY 'password' WITH GRANT OPTION;`   
   
刪除使用者   
`DROP USER'root'@'192.168.182.1';`   
`FLUSH PRIVILEGES;`   
   
保存更改   
`FLUSH PRIVILEGES;`   
`select user,host from mysql.user;`   
   
修改文字客服設定檔   
`cd /SRM/Helpdesk4J/AppData/cfg`   
`cp Server.properties Server.properties`   
`vi Server.properties`   
   
設定使用的DB   
`db.vendor = maria
db.url = jdbc:mysql://192.168.182.136:3306/Helpdesk4J
db.driver = org.mariadb.jdbc.Driver`   
   
DB的帳號密碼   
`db.cp = HikariCP
db.user = root
db.pw = password`   
   
第一次創建資料庫時使用 create，之後使用update   
`hibernate.hbm2ddl = create`   
   
修改Helpdesk4J的網址   
`hd4j.context.url = http://192.168.182.136:8081
hd4j.context.root = /Helpdesk4J/`   
   
修改Webhook的網址   
`webhook.context.url = http://192.168.182.136:8081
webhook.context.root = /Webhook/`   
   
修改tomcat port號   
[Tomcat端口配置（详细）\_tomcat修改端口-CSDN博客](https://blog.csdn.net/weixin_69553582/article/details/124893517)   
`vim /SRM/Helpdesk4J/tomcat9/conf/server.xml`   
```
<Connector port="8081" protocol="HTTP/1.1"
           URIEncoding="UTF-8"
           connectionTimeout="20000"
           redirectPort="8443"/>


```
砍掉先前tomcat的port 8080   
`ps aux \| grep tomcat`   
`lsof -i :8080`   
`netstat -tuln \| grep 8080`   
`kill -9 [PID]`   
   
更改 /SRM/ 權限   
`chmod 755 /SRM/ -R`   
   
更改Startup.sh檔   
`./bin/Startup.sh`   
```
#!/bin/bash
export JAVA_HOME=/SRM/Helpdesk4J/openjdk
export JRE_HOME=$JAVA_HOME/jre
export PATH=$JAVA_HOME/bin:$PATH
export CATALINA_HOME=/SRM/Helpdesk4J/tomcat9
export CATALIAN_PID=catalinaPid
export JAVA_OPTS="${JAVA_OPTS} -DappData=/SRM/Helpdesk4J/AppData -Xmx1562M -Xms512M -XX:MetaspaceSize=256M -Djava.util.logging.config.file=${CATALINA_HOME}/conf/logging.properties"
${CATALINA_HOME}/bin/startup.sh

```
   
執行Helpdesk4J   
`cd /SRM/Helpdesk4J`   
`./bin/Startup.sh`   
![image_e 1.png](/img/user/img/image_e%201.png)
查看tomcat log服務是否正常   
`less /SRM/Helpdesk4J/tomcat9/logs/catalina.out`   
![image_d 1.png](/img/user/img/image_d%201.png)
   
全部步驟順利的話~成功啟動   
http://192.168.182.136:8081/Helpdesk4J/login   
![image_s 1.png](/img/user/img/image_s%201.png)
   
登入帳號密碼，驚嘆號記得打   
admin   
intumit!!   
http://192.168.182.136:8081/Webhook/    
   
   
啟動時連線異常區要開啟rabbitmq的stomp   
安裝php   
sudo dnf install -y php php-cli php-json php-zip php-common   
安裝composer   
sudo curl -sS https://getcomposer.org/installer \| sudo php   
將composer安裝移動到系統路徑   
sudo mv /SRM/Helpdesk4J/composer.phar /usr/local/bin/composer   
Composer 安装 `webman/stomp` 包   
composer require webman/stomp   
啟用 RabbitMQ STOMP 插件   
rabbitmq-plugins enable rabbitmq\_stomp   
   
文字客服串接robot   
   
因為admin能操作的權限只有新增使用者   
![image_r 1.png](/img/user/img/image_r%201.png)
需要添加一位全開權限   
aa   
12345678   
登入之後設定>來源設定   
新增智能客服網址   
http://192.168.182.129:8023/    
![image_1 1.png](/img/user/img/image_1%201.png)
   
#Robot Sector：目前支援三種type，Real / Fake / NoOp   
#Real：與真的Robot串接，啟動之後自行到來源設定裡面填寫API key    
#Fake：自帶假的Robot，只會複讀客戶說的話，只為了開發與測試用    
#NoOp：進線直接轉真人   
   
修改設定成Real   
robot.type = Real   
   
填入API key設定啟用   
![image_4 1.png](/img/user/img/image_4%201.png)
![image_4l.png](/img/user/img/image_4l.png)

添加有效的License key   
vim /SRM/Helpdesk4J/AppData/license/license.xml   
```
<?xml version="1.0" encoding="UTF-8"?><Helpdesk4J-License>
    <客戶名稱>LHC01D181 碩網資訊股份有限公司 產品開發</客戶名稱>
    <同時上線人數>15</同時上線人數>
    <有效期限>2032-12-31</有效期限>
    <是否串接SmartRobot>true</是否串接SmartRobot>
<Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI=""><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>3JO83srJ3CDqtg3p/hHpQWe5FIk=</DigestValue></Reference></SignedInfo><SignatureValue>OBf2lpo3V/P2Q2YCEQo5VZyfk6KKAHZvudnPPIjjLAPSuOsS/yl2aSAuvlrJl67+w+JMifVG6+8R
tnMmjM2XpkbSGRdceP4CUqGkFxstYUQR3YlBcRdRN/1bflYmzu4nsQOTFYK3HcrBC7cSrkbLU0Ie
LpyfwbpWnSAC4yqn3B0=</SignatureValue><KeyInfo><KeyValue><RSAKeyValue><Modulus>+Zs6csQLLJCU4Cuasrh3i8tBvy8Oglsx1sk5aO81gCEydryLfR5gGUtdsftMPJt6JogacM1UINdL
5IOpgJUm+sfyyg1hsLWMmsW6+JHPmqIrt+/jURB+87en+HCipq4ucEg1O6P9xeBTNH9naEW0q8Q9
ZgcZDuaAFGW0xBkhDS0=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue></KeyValue></KeyInfo></Signature></Helpdesk4J-License>

```    
![image_x 1.png](/img/user/img/image_x%201.png)

最後成功串接   
![image 1.png](/img/user/img/image%201.png)    
![image_13.png](/img/user/img/image_13.png)